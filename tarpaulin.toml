# Cargo-tarpaulin configuration for test coverage reporting
# Reference: https://github.com/xd009642/tarpaulin
#
# Uses LLVM source-based coverage (--engine llvm) instead of ptrace.
# ptrace (Linux default) causes segfaults with subprocess spawning,
# large codegen, and cumulative memory pressure.
# LLVM coverage is also default on Mac/Windows.

[coverage]
# Use LLVM source-based coverage instead of ptrace
engine = "llvm"

# Timeout for the entire coverage process (in seconds)
timeout = "300s"

# Output formats
out = ["Html", "Lcov", "Json"]

# Output directory for coverage reports
output-dir = "target/coverage"

# Exclude files from coverage measurement (not from test execution)
exclude-files = [
    "benches/*",
    "examples/*",
]

# Exclude packages from coverage
# Matches codecov.yml ignore list and cargo-llvm-cov --exclude flags
exclude = [
    "vais-benches",
    "vais-python",
    "vais-node",
    "vais-playground-server",
    "vais-dap",
    "vais-tutorial",
]

# Ignore panics during execution
ignore-panics = true

# Include test function lines in coverage
ignore-tests = false

# Count lines of code
count = true

# Work with multiple packages
workspace = true

# Run all target types
lib = true
bins = false
examples = false
tests = true

# Use colored output
color = "Auto"

# Parallel execution
parallel = false

# Verbose output for debugging
verbose = true

# Run debug builds for accurate source mapping
release = false

# Follow child process execution (safe with LLVM engine, no ptrace conflicts)
follow-exec = true

# Include all features
all-features = false
