# Cargo-tarpaulin configuration for test coverage reporting
# Reference: https://github.com/xd009642/tarpaulin
#
# IMPORTANT: tarpaulin uses ptrace on Linux, which conflicts with tests that
# spawn subprocesses (clang, compiled binaries). Only lib tests and integration
# tests that do NOT spawn subprocesses are included.
# See: https://github.com/xd009642/tarpaulin/issues/317

[coverage]
# Timeout for the entire coverage process (in seconds)
timeout = "300s"

# Output formats
out = ["Html", "Lcov", "Json"]

# Output directory for coverage reports
output-dir = "target/coverage"

# Exclude files from coverage measurement (not from test execution)
exclude-files = [
    "benches/*",
    "examples/*",
]

# Exclude packages from coverage
exclude = [
    "vais-benches",
    "vais-python",
    "vais-node",
    "vais-dap",
    "vais-playground-server",
]

# Ignore panics during execution
ignore-panics = true

# Include test function lines in coverage
ignore-tests = false

# Count lines of code
count = true

# Work with multiple packages
workspace = true

# Run lib targets (inline #[cfg(test)] unit tests — always safe)
lib = true

# Do NOT run binary targets
bins = false

# Do NOT run example targets
examples = false

# Run integration test targets (filtered by --test in CI)
tests = true

# Use colored output
color = "Auto"

# Parallel execution (disabled — ptrace is single-threaded)
parallel = false

# Precise reporting (line-level granularity)
precise = true

# Verbose output for debugging
verbose = true

# Run debug builds for accurate source mapping
release = false

# Do NOT follow child process execution — ptrace conflicts with subprocess spawning
follow-exec = false

# Include all features
all-features = false
