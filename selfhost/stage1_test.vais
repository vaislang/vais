# Stage 1 compiler test - import multiple modules
U token
U lexer

F main() -> i64 {
    puts("=== Vais Stage 1 Compiler Test ===\n")

    # Test source code - convert str to ptr
    source := "F main() -> i64 { 42 }"
    source_ptr := str_to_ptr(source)
    source_len := strlen(source)

    # Create lexer with pointer and length
    lex := Lexer.new(source_ptr, source_len)

    # Tokenize
    tokens := lex.tokenize()

    puts("Tokenized ")
    print_i64(tokens.len())
    puts(" tokens\n")

    # Print first few tokens
    i: mut i64 = 0
    L {
        I i >= tokens.len() { B } E { 0 }
        I i >= 5 { B } E { 0 }  # Only first 5
        tk := tokens.get(i)
        puts("Token ")
        print_i64(i)
        puts(": kind=")
        print_i64(tk.kind)
        putchar(10)
        i = i + 1
    }

    puts("\nStage 1 test complete!\n")
    0
}

F print_i64(val: i64) -> i64 {
    I val == 0 {
        putchar(48)
        0
    } E I val < 0 {
        putchar(45)
        print_i64(0 - val)
    } E {
        I val >= 10 {
            print_i64(val / 10)
            0
        } E { 0 }
        putchar(48 + (val % 10))
        0
    }
}
